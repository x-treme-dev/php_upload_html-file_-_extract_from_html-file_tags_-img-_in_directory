var BnWidget=function(a){this.id="";this.type=this.element=null;this.position="";this.options=this.adapter=this.position_element=null;this.url=window.location.href;this.time=Math.floor(Date.now()/1E3);this.is_show=!0;this.is_rendered=!1;this.data={};for(var b in a)a.hasOwnProperty(b)&&this.setData(b,a[b]);this.visible_time_start=null;this.visible_timer=0};
BnWidget.prototype={setData:function(a,b){this.hasOwnProperty(a)&&"function"!==typeof this[a]?this[a]=b:"function"===typeof b?this[a]=b:this.data[a]=b},getData:function(a){return"time"===a?this.getTimer():"visible_time"===a?this.getVisibleTimer():"is_visible"===a?this.isVisible():this.hasOwnProperty(a)?this[a]:this.data.hasOwnProperty(a)?this.data[a]:null},getId:function(){return this.getData("id")},getType:function(){return this.getData("type")},getPosition:function(){return this.getData("position")},
    getElement:function(){return this.getData("element")},getUrl:function(){return this.getData("url")},isShow:function(){return this.is_show},isVisible:function(){var a=this.getElement().getBoundingClientRect(),b=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(0>a.bottom||0<=a.top-b)},hide:function(){var a=this.getData("adapter");if(a&&a.hasOwnProperty("hide")&&"function"===typeof a.hide)a.hide(this);else return this.element.style.display="none";this.is_show=!1},show:function(){this.is_rendered||
    this.render();var a=this.getData("adapter");if(a&&a.hasOwnProperty("show")&&"function"===typeof a.show)a.show(this);else return this.element.style.display="";this.is_show=!0},render:function(){var a=this.getData("adapter");return a?(this.is_rendered=!0,a.render(this)):!1},reload:function(){var a=this.getData("adapter");if(a&&(!a.hasOwnProperty("beforeReload")||a.beforeReload(this))){if(!this.is_rendered)return this.render();a.reload(this);a.hasOwnProperty("afterReload")&&a.afterReload(this)}},remove:function(){var a=
        this.getData("element");return a?(a.remove(),BnWidgets.bnWidgets.removeById(this.getId()),!0):!1},restartTimer:function(){this.time=Math.floor(Date.now()/1E3)},getTimer:function(){return Math.floor(Date.now()/1E3)-this.time},restartVisibleTimer:function(){this.visible_timer=0;this.visible_time_start=Math.floor(Date.now()/1E3)},stopVisibleTimer:function(){this.visible_time_start&&(this.visible_timer=this.getVisibleTimer(),this.visible_time_start=null)},startVisibleTimer:function(){null===this.visible_time_start&&
    (this.visible_time_start=Math.floor(Date.now()/1E3))},getVisibleTimer:function(){var a=0;this.visible_time_start&&(a=Math.floor(Date.now()/1E3)-this.visible_time_start);return this.visible_timer+a}};var BnWidgetsCollection=function(){this.bnWidgets=[];this._count=0};
BnWidgetsCollection.prototype={set:function(a){this.bnWidgets.push(a);this._count++},getById:function(a){var b=this.bnWidgets,c;for(c in b)if(b.hasOwnProperty(c)&&b[c].getId()===a)return b[c];return null},filter:function(a,b,c){c=c||"=";var d=new BnWidgetsCollection,e=this.bnWidgets,g;for(g in e){var f=e[g];if("function"===typeof a){if(!a(f))continue}else{var h=f.getData(a);if("url"===a){if(-1===b.indexOf(h))continue}else if("="===c&&h!==b)continue;else if("!="===c&&h===b)continue;else if("<"===c&&
        b<h)continue;else if(">"===c&&b>h)continue}d.set(f)}return d},callback:function(a){var b=this.bnWidgets,c;for(c in b)a(b[c])},getAll:function(){return this.bnWidgets},show:function(){this.callback(function(a){a.show()})},hide:function(){this.callback(function(a){a.hide()})},reload:function(){this.callback(function(a){a.reload()})},remove:function(){this.callback(function(a){a.remove()})},removeById:function(a){var b=this.bnWidgets,c;for(c in b)b.hasOwnProperty(c)&&b[c].getId()===a&&delete this.bnWidgets[c]},
    count:function(){return this._count}};
var BnWidgets={debug:!1,isInited:!1,intersectionObserver:null,settings:{min_bnWidget_show_time:10,position_container_class:".banner",position_attr:"data-key",bnWidget_init_attr:"data-banner-init"},settings_updater:function(){fetch("/banners/settings").then(function(a){return a.json()}).then(function(a){"object"==typeof a&&(localStorage.banners_settings=JSON.stringify(a),BnWidgets.applySettings(a))})},bnWidgets:new BnWidgetsCollection,reload_all_timer:0,reload_all_min_time:10,base_adapter:{init:function(){},
        initContainer:function(a){var b=!1;a&&(b=document.getElementById(a));if(b||(b=document.getElementById("banner-init")))return b;if(a=document.currentScript)return b=BnWidgets.createBannerContainer(),a.parentNode.insertBefore(b,document.currentScript),b;console.log("\u0414\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0431\u0430\u043d\u043d\u0435\u0440\u0430 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 ajax \u043f\u043e\u0434\u0433\u0440\u0443\u0437\u043a\u0435 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u0441 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0435\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 <div id='randomid-234234'><script>BnWidgets.init('adfox',{...options},'randomid-234234');\x3c/script>");
            return!1},bindBannerToFunction:function(a,b){var c=b.getElement(),d=b.getOptions();return BnWidgets.bindToFunction(a,{banner:b,container:c,options:d})},render:function(a){return!1},beforeReload:function(a){return a.getTimer()>BnWidgets.settings.min_bnWidget_show_time},reload:function(a){},afterReload:function(a){a.restartTimer()},reloadAll:function(a){BnWidgets.getAll(a).reload()},hide:function(a){a.getElement().style.display="none"},show:function(a){a.getElement().style.display=""},remove:function(a){a.getElement().remove()}},
    adapter:{adfox:{isInit:function(){return window.hasOwnProperty("yaContextCb")},beforeReload:function(a){return BnWidgets.base_adapter.beforeReload(a)},reload:function(a){if(this.isInit())BnWidgets.debug&&console.log("Reload banner: "+a.getPosition()+" id="+a.getId()),window.yaContextCb.push(function(){Ya.adfoxCode.reload(a.getId(),{onlyIfWasVisible:!1})});else throw"\u041d\u0435\u0442 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u0431\u0430\u043d\u0435\u0440\u043e\u0432!";},render:function(a){},afterReload:function(a){return BnWidgets.base_adapter.afterReload(a)},
            reloadAll:function(){if(this.isInit())return window.Ya.adfoxCode.reload();throw"\u041d\u0435\u0442 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u0431\u0430\u043d\u0435\u0440\u043e\u0432!";},initContainer:function(a){return BnWidgets.base_adapter.initContainer(a)},hide:function(a){BnWidgets.base_adapter.hide(a)},show:function(a){BnWidgets.base_adapter.show(a)},remove:function(a){BnWidgets.base_adapter.remove(a)}}},init:function(a){this.isInited?this.applySettings(a):(this.bnWidgets=new BnWidgetsCollection,
        this.applySettings(a),this.startReloadTimer(),this.initBrowserEvents(),this.isInited=!0)},initBrowserEvents:function(){document.addEventListener("DOMContentLoaded",BnWidgets.bnWidgetsCollector);document.addEventListener("popstate",function(){setTimeout(BnWidgets.bnWidgetsCollector,1E3)});var a=this;localStorage.hasOwnProperty("banners_settings")&&BnWidgets.applySettings(JSON.parse(localStorage.banners_settings));setInterval(function(){"function"===typeof a.settings_updater&&a.settings_updater()},
        6E4);var b=Math.floor(Date.now()/1E3);window.addEventListener("scroll",function(){var c=Math.floor(Date.now()/1E3);c>b&&(b=c,BnWidgets.bnWidgetsCollector())});this.intersectionObserver=new IntersectionObserver(function(c,d){c.forEach(function(e){if(e.isIntersecting){var g=BnWidgets.bnWidgets.getById(e.target.id);if(g){var f=g.getData("intersectionRatio");g.setData("intersectionRatio",e.intersectionRatio);f?f<e.intersectionRatio&&.9<e.intersectionRatio?g.startVisibleTimer():f>e.intersectionRatio&&
        .5>e.intersectionRatio&&g.stopVisibleTimer():.9<e.intersectionRatio&&(g.startVisibleTimer(),g.setData("url",window.location.href))}}})},{rootMargin:"0px",threshold:[0,.5,1]})},bnWidgetsCollector:function(){var a=document.querySelectorAll("["+BnWidgets.settings.position_attr+"]"),b;for(b in a)a.hasOwnProperty(b)&&BnWidgets.addWidget(a[b])},applySettings:function(a){"object"===typeof a&&(this.settings=Object.assign(this.settings,a))},bindToFunction:function(a,b){var c=[].slice.call(arguments,2);return function(){var d=
        [].slice.call(arguments);d=c.concat(d);return a.apply(b,d)}},closest:function(a,b,c){var d;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]?(d=e,!0):!1});a;)if((a=a.parentElement)&&(a[d](b)||"function"===typeof c&&c(a)))return a;return null},uniqueid:function(){var a=1110.5+9998889*Math.random();return a=Math.round(a)},initBnWidget:function(a,b){b=b||"adfox";var c=null;a&&(c=this.getBnWidgetsContainerKey(a));
        var d=a.querySelector("[data-is_banner]"),e=void 0;this.adapter.hasOwnProperty(b)&&(e=this.adapter[b]);if(d)return d.className+=" banner-"+b,d.className+=" banner-container",d={id:d.id,element:d,type:b,adapter:e},c&&(d.position=c,d.position_element=a),new BnWidget(d)},addWidget:function(a,b){if("1"!==a.getAttribute(BnWidgets.settings.bnWidget_init_attr)){a.setAttribute(BnWidgets.settings.bnWidget_init_attr,"1");var c=this.initBnWidget(a,b);if(c){this.applyWidgetBinds(c);this.bnWidgets.set(c);var d=
        c.getElement();d&&this.intersectionObserver.observe(d);c.render();return c}}},position_binds:{},bindToPosition:function(a,b,c){BnWidgets.position_binds.hasOwnProperty(a)||(BnWidgets.position_binds[a]={});BnWidgets.position_binds[a].hasOwnProperty(b)?console.error("Bind to Widget with position ["+a+"] exists!"):BnWidgets.position_binds[a][b]=c},applyWidgetBinds:function(a){var b=a.getPosition();if(BnWidgets.position_binds.hasOwnProperty(b)){b=BnWidgets.position_binds[b];for(var c in b)b.hasOwnProperty(c)&&
    a.setData(c,BnWidgets.bindToFunction(b[c],a))}},findBannerPositionElement:function(a){return(a=this.closest(a,this.settings.position_container_class,function(b){return b.hasAttribute(this.settings.position_attr)}))?a:null},getBnWidgetsContainerKey:function(a){if(a){var b=a.getAttribute(this.settings.position_attr);b||(b="bnWidgets-container-id-"+this.uniqueid(),a.setAttribute(this.settings.position_attr,b));return b}return null},getBnWidgetsVisible:function(){return this.bnWidgets.filter("is_visible",
        !0)},reloadAll:function(){if(this.getReloadTimer()>this.reload_all_min_time)for(var a in this.adapter){var b=this.adapter[a];b.hasOwnProperty("reloadAll")&&"function"===typeof b.reloadAll?(b.reloadAll(),this.startReloadTimer()):this.bnWidgets.filter("type",a).reload()}},reloadVisible:function(){this.getBnWidgetsVisible().reload()},hideAll:function(a){var b=this.bnWidgets;a&&(b=b.filter("type",a));b.hide()},showAll:function(a){var b=this.bnWidgets;a&&(b=b.filter("type",a));b.show()},getReloadTimer:function(){return Math.floor(Date.now()/
        1E3)-this.reload_all_timer},startReloadTimer:function(){this.reload_all_timer=Math.floor(Date.now()/1E3)},removeAll:function(){this.bnWidgets.remove()},documentIsVisible:function(){return"visible"===document.visibilityState}};BnWidgets.init();
BnWidgets.updaterDesktop=function(a,b,c){if(!a||"visible"===document.visibilityState){var d=BnWidgets.bnWidgets.filter("position","2016_wide_1");if(0<d.count()){var e=d.filter("time",b,">");b=e.filter("fixed",!0);var g=e.filter("is_visible",!0),f=e.filter("is_visible",!1);a&&(f=f.filter("url",window.location.href));e=null;1===b.count()?e=b.getAll()[0]:0<g.count()?(b=g.getAll()[0],320<parseInt(b.position_element.clientTop+b.position_element.getBoundingClientRect().top)?(b.restartVisibleTimer(),b.reload(),
    a?d.callback(function(h){h.restartTimer()}):b.restartTimer()):e=b):0<f.count()&&(b=f.getAll(),e=a?b[0]:b[Math.floor(Math.random()*b.length)]);e instanceof BnWidget&&(e.restartVisibleTimer(),a&&e.toggleFixed(!0),e.reload(),a?d.callback(function(h){h.restartTimer()}):e.restartTimer())}else d=BnWidgets.bnWidgets.filter("position","2016_wide_1_freeze").filter("time",b,">"),0<d.count()&&(e=d.getAll()[0],e.reload(),e.restartVisibleTimer(),e.restartTimer());c=BnWidgets.bnWidgets.filter("time",c,">").filter("position",
    "2016_wide_1_freeze","!=").filter("position","2016_wide_1","!=");a&&(c=c.filter("is_visible",!0));c.reload();c.callback(function(h){h.restartTimer()})}};BnWidgets.updaterMobile=function(a,b,c){a&&"visible"!==document.visibilityState||(BnWidgets.bnWidgets.filter("position","2016_m_wide_1_freeze").filter("time",b,">").reload(),b=BnWidgets.bnWidgets.filter("time",c,">").filter("position","2016_m_wide_1_freeze","!="),a&&(b=b.filter("is_visible",!0)),b.reload())};
window.addEventListener("scroll",function(){var a=1;BnWidgets.settings.hasOwnProperty("viewability")&&(a=parseInt(BnWidgets.settings.viewability));if(a){var b=BnWidgets.bnWidgets.filter("is_visible",!0).filter("position","2016_wide_1").getAll();a={};for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=parseInt(d.position_element.clientTop+d.position_element.getBoundingClientRect().top);a[e]={widget:d,position:e}}for(var g in a)a.hasOwnProperty(g)&&(c=a[g].widget,b=c.getData("fixed"),d=e+c.getElement().offsetHeight,
    69>g&&!0!==b&&!c.getElement().classList.contains("widget_fixed_out")?4>c.getVisibleTimer()&&c.toggleFixed(!0):4<c.getVisibleTimer()&&!0===b?c.toggleFixed(!1):310<d&&!0===b&&(c.toggleFixed(!1),c.getElement().classList.remove("widget_fixed_out")))}});
BnWidgets.bindToPosition("2016_wide_1","toggleFixed",function(a){var b=this,c=function(f,h){var k;["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(m){return"function"==typeof document.body[m]?(k=m,!0):!1});for(var l;f;){if((l=f.parentElement)&&l[k](h))return l;f=l}return null};a=a||!1;var d=b.getElement(),e=function(){var f=BnWidgets.bnWidgets.filter("is_visible",!0).filter("position","2016_banner_1","=").getAll(),h;for(h in f)if(f.hasOwnProperty(h)){var k=
    c(f[h].getElement(),".sticky-container-item");if(k||(k=c(f[h].getElement(),".aside__scroller")))return k}}(),g=null;e&&(g=parseInt(window.getComputedStyle(e).top.replace(/px/,"")));a?(this.position_element.style.height=d.offsetHeight.toString()+"px",d.classList.remove("widget_fixed_out"),d.classList.add("widget_fixed"),BnWidgets.bnWidgets.filter("position",this.getPosition()).filter("fixed",!0).callback(function(f){f.toggleFixed(!1)}),a=BnWidgets.closest(this.getElement(),".article-content"),e&&null===
a&&(e.style.top=g+d.offsetHeight+"px"),this.setData("fixed",!0),this.setData("fixed_timer",setTimeout(function(){clearInterval(b.getData("fixed_timer"));b.toggleFixed(!1)},4E3))):(!0===this.getData("fixed")&&e&&(e.style.top="70px"),this.getData("fixed_timer")&&clearInterval(this.getData("fixed_timer")),d.classList.add("widget_fixed_out"),d.classList.remove("widget_fixed"),b.setData("fixed",!1),setTimeout(function(){d.classList.remove("widget_fixed_out");b.position_element.style.height="inherit"},
    500))});